# ============================================================================
# CONFIGURAÇÕES ADICIONAIS DE SERVIÇOS RENDER
# ============================================================================
# Este arquivo complementa render.yaml para configurações específicas

# --------------------------------------------------------------------------
# WORKER - Bot Autônomo
# --------------------------------------------------------------------------
worker:
  type: worker
  runtime: python
  name: binance-bot-worker
  env: python
  plan: free

  # Comandos de build e start
  buildCommand: pip install --upgrade pip && pip install -r requirements.txt
  startCommand: python bot_master.py

  # Configurações de ambiente
  envVars:
    PYTHON_VERSION: "3.11"
    SCAN_INTERVAL: "60"
    MONITOR_INTERVAL: "15"
    MAX_POSITIONS: "3"
    MIN_SIGNAL_STRENGTH: "28"
    ALAVANCAGEM_PADRAO: "50"
    RISCO_MAXIMO_POR_OPERACAO: "0.12"
    STOP_LOSS_PERCENTUAL: "0.015"
    TAKE_PROFIT_PERCENTUAL: "0.025"

  # Variáveis sensíveis (definir manualmente no Render)
  secrets:
    - BINANCE_API_KEY
    - BINANCE_API_SECRET
    - OPENAI_API_KEY
    - TELEGRAM_BOT_TOKEN
    - TELEGRAM_CHAT_ID

  # Health check (opcional - para worker services)
  healthCheck:
    path: /health
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3

# --------------------------------------------------------------------------
# WEB - Dashboard Streamlit
# --------------------------------------------------------------------------
dashboard:
  type: web
  runtime: python
  name: binance-dashboard
  env: python
  plan: free

  buildCommand: pip install --upgrade pip && pip install -r requirements.txt
  startCommand: streamlit run dashboard.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true

  envVars:
    PYTHON_VERSION: "3.11"
    PORT: "8501"
    STREAMLIT_SERVER_HEADLESS: "true"
    STREAMLIT_SERVER_ADDRESS: "0.0.0.0"
    STREAMLIT_SERVER_ENABLE_CORS: "false"
    STREAMLIT_SERVER_ENABLE_XSRF_PROTECTION: "true"

  # Variáveis de ambiente para conexão com o banco
  databaseEnvVars:
    DATABASE_URL: ${self.databases.binance-bot-db.internalURL}

# --------------------------------------------------------------------------
# DATABASE - PostgreSQL Configuration
# --------------------------------------------------------------------------
database:
  name: binance-bot-db
  databaseName: binance_bot
  user: binance_bot_user
  plan: free

  # Configurações de backup
  backups: true
  backupRetentionDays: 7

  # IP AllowList para segurança (descomentar e ajustar conforme necessário)
  # ipAllowList:
  #   - source: 0.0.0.0/0
  #     description: "Allow all (temporarily for setup)"
